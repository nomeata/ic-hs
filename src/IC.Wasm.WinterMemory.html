<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">{-|

This module provides a thin wrapper around the winter Wasm engine, exposing just
the bits needed for accessing the stable memory. This will hopefully go away once
multiple memories are supported.
-}</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">IC.Wasm.WinterMemory</span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#Memory"><span class="hs-identifier">Memory</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#new"><span class="hs-identifier">new</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#size"><span class="hs-identifier">size</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#grow"><span class="hs-identifier">grow</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#read"><span class="hs-identifier">read</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#write"><span class="hs-identifier">write</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#export"><span class="hs-keyword">export</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#imp"><span class="hs-identifier">imp</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">read</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Wasm.Runtime.Memory</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Wasm.Syntax.Types</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Wasm.Syntax.Memory</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">W</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">type</span><span> </span><span id="HostM"><span class="annot"><a href="IC.Wasm.WinterMemory.html#HostM"><span class="hs-identifier hs-var">HostM</span></a></span></span><span> </span><span id="local-6989586621679321204"><span class="annot"><a href="#local-6989586621679321204"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679321204"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">type</span><span> </span><span id="Memory"><span class="annot"><a href="IC.Wasm.WinterMemory.html#Memory"><span class="hs-identifier hs-var">Memory</span></a></span></span><span> </span><span id="local-6989586621679321203"><span class="annot"><a href="#local-6989586621679321203"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">W.MemoryInst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679321203"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span id="local-6989586621679321202"><span class="annot"><a href="IC.Wasm.WinterMemory.html#new"><span class="hs-identifier hs-type">new</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#HostM"><span class="hs-identifier hs-type">HostM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321202"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Wasm.WinterMemory.html#Memory"><span class="hs-identifier hs-type">Memory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321202"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-34"></span><span id="new"><span class="annot"><span class="annottext">new :: HostM s (Memory s)
</span><a href="IC.Wasm.WinterMemory.html#new"><span class="hs-identifier hs-var hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MemoryError -&gt; String)
-&gt; ExceptT MemoryError (ST s) (Memory s) -&gt; HostM s (Memory s)
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span> </span><span class="annot"><span class="annottext">MemoryError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT MemoryError (ST s) (Memory s) -&gt; HostM s (Memory s))
-&gt; ExceptT MemoryError (ST s) (Memory s) -&gt; HostM s (Memory s)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MemoryType -&gt; ExceptT MemoryError (ST s) (Memory s)
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MemoryType -&gt; ExceptT MemoryError m (MemoryInst m)
</span><span class="hs-identifier hs-var">W.alloc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int32 -&gt; Maybe Int32 -&gt; MemoryType
forall a. a -&gt; Maybe a -&gt; Limits a
</span><span class="hs-identifier hs-var">W.Limits</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Maybe Int32
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span id="local-6989586621679321197"><span class="annot"><a href="IC.Wasm.WinterMemory.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#Memory"><span class="hs-identifier hs-type">Memory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321197"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#HostM"><span class="hs-identifier hs-type">HostM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321197"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">W.Size</span></span></span><span>
</span><span id="line-37"></span><span id="size"><span class="annot"><span class="annottext">size :: Memory s -&gt; HostM s Int32
</span><a href="IC.Wasm.WinterMemory.html#size"><span class="hs-identifier hs-var hs-var">size</span></a></span></span><span> </span><span id="local-6989586621679321195"><span class="annot"><span class="annottext">mem :: Memory s
</span><a href="#local-6989586621679321195"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s Int32 -&gt; HostM s Int32
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s Int32 -&gt; HostM s Int32) -&gt; ST s Int32 -&gt; HostM s Int32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Memory s -&gt; ST s Int32
forall (m :: * -&gt; *). PrimMonad m =&gt; MemoryInst m -&gt; m Int32
</span><span class="hs-identifier hs-var">W.size</span></span><span> </span><span class="annot"><span class="annottext">Memory s
</span><a href="#local-6989586621679321195"><span class="hs-identifier hs-var">mem</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span id="local-6989586621679321192"><span class="annot"><a href="IC.Wasm.WinterMemory.html#grow"><span class="hs-identifier hs-type">grow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#Memory"><span class="hs-identifier hs-type">Memory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321192"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">W.Size</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#HostM"><span class="hs-identifier hs-type">HostM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321192"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">W.Size</span></span></span><span>
</span><span id="line-40"></span><span id="grow"><span class="annot"><span class="annottext">grow :: Memory s -&gt; Int32 -&gt; HostM s Int32
</span><a href="IC.Wasm.WinterMemory.html#grow"><span class="hs-identifier hs-var hs-var">grow</span></a></span></span><span> </span><span id="local-6989586621679321191"><span class="annot"><span class="annottext">mem :: Memory s
</span><a href="#local-6989586621679321191"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621679321190"><span class="annot"><span class="annottext">delta :: Int32
</span><a href="#local-6989586621679321190"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s Int32 -&gt; HostM s Int32
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ST s Int32 -&gt; HostM s Int32) -&gt; ST s Int32 -&gt; HostM s Int32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-comment">-- See memory.grow impl in src/Wasm/Exec/Eval.hs</span><span>
</span><span id="line-42"></span><span>  </span><span id="local-6989586621679321189"><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679321189"><span class="hs-identifier hs-var">oldSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Memory s -&gt; ST s Int32
forall (m :: * -&gt; *). PrimMonad m =&gt; MemoryInst m -&gt; m Int32
</span><span class="hs-identifier hs-var">W.size</span></span><span> </span><span class="annot"><span class="annottext">Memory s
</span><a href="#local-6989586621679321191"><span class="hs-identifier hs-var">mem</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span id="local-6989586621679321188"><span class="annot"><span class="annottext">Either MemoryError ()
</span><a href="#local-6989586621679321188"><span class="hs-identifier hs-var">eres</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT MemoryError (ST s) () -&gt; ST s (Either MemoryError ())
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT MemoryError (ST s) () -&gt; ST s (Either MemoryError ()))
-&gt; ExceptT MemoryError (ST s) () -&gt; ST s (Either MemoryError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Memory s -&gt; Int32 -&gt; ExceptT MemoryError (ST s) ()
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MemoryInst m -&gt; Int32 -&gt; ExceptT MemoryError m ()
</span><span class="hs-identifier hs-var">W.grow</span></span><span> </span><span class="annot"><span class="annottext">Memory s
</span><a href="#local-6989586621679321191"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679321190"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="annottext">Int32 -&gt; ST s Int32
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Int32 -&gt; ST s Int32) -&gt; Int32 -&gt; ST s Int32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either MemoryError ()
</span><a href="#local-6989586621679321188"><span class="hs-identifier hs-var">eres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-45"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-46"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679321189"><span class="hs-identifier hs-var">oldSize</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span id="local-6989586621679321185"><span class="annot"><a href="IC.Wasm.WinterMemory.html#read"><span class="hs-identifier hs-type">read</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#Memory"><span class="hs-identifier hs-type">Memory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321185"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">W.Address</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">W.Size</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#HostM"><span class="hs-identifier hs-type">HostM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321185"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span></span><span>
</span><span id="line-49"></span><span id="read"><span class="annot"><span class="annottext">read :: Memory s -&gt; Address -&gt; Int32 -&gt; HostM s ByteString
</span><a href="IC.Wasm.WinterMemory.html#read"><span class="hs-identifier hs-var hs-var">read</span></a></span></span><span> </span><span id="local-6989586621679321184"><span class="annot"><span class="annottext">mem :: Memory s
</span><a href="#local-6989586621679321184"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621679321183"><span class="annot"><span class="annottext">ptr :: Address
</span><a href="#local-6989586621679321183"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span id="local-6989586621679321182"><span class="annot"><span class="annottext">len :: Int32
</span><a href="#local-6989586621679321182"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MemoryError -&gt; String)
-&gt; ExceptT MemoryError (ST s) ByteString -&gt; HostM s ByteString
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span> </span><span class="annot"><span class="annottext">MemoryError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT MemoryError (ST s) ByteString -&gt; HostM s ByteString)
-&gt; ExceptT MemoryError (ST s) ByteString -&gt; HostM s ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Memory s
-&gt; Address -&gt; Int32 -&gt; ExceptT MemoryError (ST s) ByteString
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MemoryInst m
-&gt; Address -&gt; Int32 -&gt; ExceptT MemoryError m ByteString
</span><span class="hs-identifier hs-var">W.loadBytes</span></span><span> </span><span class="annot"><span class="annottext">Memory s
</span><a href="#local-6989586621679321184"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679321183"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Int32
</span><a href="#local-6989586621679321182"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span id="local-6989586621679321180"><span class="annot"><a href="IC.Wasm.WinterMemory.html#write"><span class="hs-identifier hs-type">write</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#Memory"><span class="hs-identifier hs-type">Memory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321180"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">W.Address</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#HostM"><span class="hs-identifier hs-type">HostM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321180"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-52"></span><span id="write"><span class="annot"><span class="annottext">write :: Memory s -&gt; Address -&gt; ByteString -&gt; HostM s ()
</span><a href="IC.Wasm.WinterMemory.html#write"><span class="hs-identifier hs-var hs-var">write</span></a></span></span><span> </span><span id="local-6989586621679321179"><span class="annot"><span class="annottext">mem :: Memory s
</span><a href="#local-6989586621679321179"><span class="hs-identifier hs-var">mem</span></a></span></span><span> </span><span id="local-6989586621679321178"><span class="annot"><span class="annottext">ptr :: Address
</span><a href="#local-6989586621679321178"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span id="local-6989586621679321177"><span class="annot"><span class="annottext">blob :: ByteString
</span><a href="#local-6989586621679321177"><span class="hs-identifier hs-var">blob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MemoryError -&gt; String)
-&gt; ExceptT MemoryError (ST s) () -&gt; HostM s ()
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span> </span><span class="annot"><span class="annottext">MemoryError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT MemoryError (ST s) () -&gt; HostM s ())
-&gt; ExceptT MemoryError (ST s) () -&gt; HostM s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Memory s -&gt; Address -&gt; ByteString -&gt; ExceptT MemoryError (ST s) ()
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MemoryInst m -&gt; Address -&gt; ByteString -&gt; ExceptT MemoryError m ()
</span><span class="hs-identifier hs-var">W.storeBytes</span></span><span> </span><span class="annot"><span class="annottext">Memory s
</span><a href="#local-6989586621679321179"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; Address
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679321178"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679321177"><span class="hs-identifier hs-var">blob</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span id="local-6989586621679321175"><span class="annot"><a href="IC.Wasm.WinterMemory.html#export"><span class="hs-keyword hs-type">export</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#Memory"><span class="hs-identifier hs-type">Memory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321175"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679321175"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span></span><span>
</span><span id="line-55"></span><span id="export"><span class="annot"><span class="annottext">export :: Memory s -&gt; ST s ByteString
</span><a href="IC.Wasm.WinterMemory.html#export"><span class="hs-keyword hs-var hs-var">export</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Memory s -&gt; ST s ByteString
forall (m :: * -&gt; *). PrimMonad m =&gt; MemoryInst m -&gt; m ByteString
</span><span class="hs-identifier hs-var">W.exportMemory</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span id="local-6989586621679321173"><span class="annot"><a href="IC.Wasm.WinterMemory.html#imp"><span class="hs-identifier hs-type">imp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Wasm.WinterMemory.html#Memory"><span class="hs-identifier hs-type">Memory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679321173"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679321173"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-58"></span><span id="imp"><span class="annot"><span class="annottext">imp :: Memory s -&gt; ByteString -&gt; ST s ()
</span><a href="IC.Wasm.WinterMemory.html#imp"><span class="hs-identifier hs-var hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Memory s -&gt; ByteString -&gt; ST s ()
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MemoryInst m -&gt; ByteString -&gt; m ()
</span><span class="hs-identifier hs-var">W.importMemory</span></span><span>
</span><span id="line-59"></span></pre></body></html>